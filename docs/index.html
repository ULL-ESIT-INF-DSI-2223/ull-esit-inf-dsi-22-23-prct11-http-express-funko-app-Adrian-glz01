<!DOCTYPE html><html class="default" lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>pr10</title><meta name="description" content="Documentation for pr10"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script async src="assets/search.js" id="search-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os"</script><header class="tsd-page-toolbar">
<div class="tsd-toolbar-contents container">
<div class="table-cell" id="tsd-search" data-base=".">
<div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M15.7824 13.833L12.6666 10.7177C12.5259 10.5771 12.3353 10.499 12.1353 10.499H11.6259C12.4884 9.39596 13.001 8.00859 13.001 6.49937C13.001 2.90909 10.0914 0 6.50048 0C2.90959 0 0 2.90909 0 6.49937C0 10.0896 2.90959 12.9987 6.50048 12.9987C8.00996 12.9987 9.39756 12.4863 10.5008 11.6239V12.1332C10.5008 12.3332 10.5789 12.5238 10.7195 12.6644L13.8354 15.7797C14.1292 16.0734 14.6042 16.0734 14.8948 15.7797L15.7793 14.8954C16.0731 14.6017 16.0731 14.1267 15.7824 13.833ZM6.50048 10.499C4.29094 10.499 2.50018 8.71165 2.50018 6.49937C2.50018 4.29021 4.28781 2.49976 6.50048 2.49976C8.71001 2.49976 10.5008 4.28708 10.5008 6.49937C10.5008 8.70852 8.71314 10.499 6.50048 10.499Z" fill="var(--color-text)"></path></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div>
<div class="field">
<div id="tsd-toolbar-links"></div></div>
<ul class="results">
<li class="state loading">Preparing search index...</li>
<li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">pr10</a></div>
<div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><rect x="1" y="3" width="14" height="2" fill="var(--color-text)"></rect><rect x="1" y="7" width="14" height="2" fill="var(--color-text)"></rect><rect x="1" y="11" width="14" height="2" fill="var(--color-text)"></rect></svg></a></div></div></header>
<div class="container container-main">
<div class="col-8 col-content">
<div class="tsd-page-title">
<h2>pr10</h2></div>
<div class="tsd-panel tsd-typography"><p><a href="https://classroom.github.com/a/8eRVZXt4"><img src="https://classroom.github.com/assets/deadline-readme-button-24ddc0f5d75046c5622901739e7c5dd533143b0c8e959d652212380cedb1ea36.svg" alt="Review Assignment Due Date"></a></p>

<a href="#informe" id="informe" style="color: inherit; text-decoration: none;">
  <h1>Informe</h1>
</a>
<p>En está práctica pondremos en prácticas los conceptos aprendidos en las clases de teoría sobre el patrón callback y el desarrollo de un servidor web a través de express</p>
<p>Asimismo se hablará del trabajo desarrollado durante la sesión práctica de la asignatura. Concreatemente de la sesión PE 102 de los lunes</p>

<a href="#índice" id="índice" style="color: inherit; text-decoration: none;">
  <h2>Índice</h2>
</a>
<ol>
<li><a href="#aplicaci%C3%B3n-de-gesti%C3%B3n-de-funkos">Aplicación de gestión de funkos</a></li>
<li><a href="#ejercicio-pe102">Ejercicio PE102</a></li>
<li><a href="#__dificultadesreflexi%C3%B3n">Dificultades/Reflexión</a></li>
<li><a href="#referencias">Referencias</a></li>
</ol>

<a href="#aplicación-de-gestión-de-funkos" id="aplicación-de-gestión-de-funkos" style="color: inherit; text-decoration: none;">
  <h2>Aplicación de gestión de funkos.</h2>
</a>
<p>Siguendo la misma aplicacion que semanas anteriores, se pide desarrollar la gestión de funkos medinate el uso de un servidor web express.</p>
<p>Para ello se ha desarrollado el siguiente código:</p>
<p>Interfaz funko:</p>
<pre><code class="language-ts"><span class="hl-0">/**</span><br/><span class="hl-0"> * </span><span class="hl-1">@description</span><span class="hl-0"> Funko interface</span><br/><span class="hl-0"> * </span><span class="hl-1">@interface</span><span class="hl-0"> </span><span class="hl-2">Funko</span><br/><span class="hl-0"> * </span><span class="hl-1">@property</span><span class="hl-0"> </span><span class="hl-2">{number}</span><span class="hl-0"> </span><span class="hl-3">_id</span><span class="hl-0"> - Funko id</span><br/><span class="hl-0"> * </span><span class="hl-1">@property</span><span class="hl-0"> </span><span class="hl-2">{string}</span><span class="hl-0"> </span><span class="hl-3">_name</span><span class="hl-0"> - Funko name</span><br/><span class="hl-0"> * </span><span class="hl-1">@property</span><span class="hl-0"> </span><span class="hl-2">{string}</span><span class="hl-0"> </span><span class="hl-3">_description</span><span class="hl-0"> - Funko description</span><br/><span class="hl-0"> * </span><span class="hl-1">@property</span><span class="hl-0"> </span><span class="hl-2">{Funko_type}</span><span class="hl-0"> </span><span class="hl-3">_type</span><span class="hl-0"> - Funko type</span><br/><span class="hl-0"> * </span><span class="hl-1">@property</span><span class="hl-0"> </span><span class="hl-2">{Funko_genre}</span><span class="hl-0"> </span><span class="hl-3">_genre</span><span class="hl-0"> - Funko genre</span><br/><span class="hl-0"> * </span><span class="hl-1">@property</span><span class="hl-0"> </span><span class="hl-2">{string}</span><span class="hl-0"> </span><span class="hl-3">_franchise</span><span class="hl-0"> - Funko franchise</span><br/><span class="hl-0"> * </span><span class="hl-1">@property</span><span class="hl-0"> </span><span class="hl-2">{number}</span><span class="hl-0"> </span><span class="hl-3">_franchise_number</span><span class="hl-0"> - Funko franchise number</span><br/><span class="hl-0"> * </span><span class="hl-1">@property</span><span class="hl-0"> </span><span class="hl-2">{boolean}</span><span class="hl-0"> </span><span class="hl-3">_exclusive</span><span class="hl-0"> - Funko exclusive</span><br/><span class="hl-0"> * </span><span class="hl-1">@property</span><span class="hl-0"> </span><span class="hl-2">{string}</span><span class="hl-0"> </span><span class="hl-3">_especialCaracteristics</span><span class="hl-0"> - Funko especial Caracteristics</span><br/><span class="hl-0"> * </span><span class="hl-1">@property</span><span class="hl-0"> </span><span class="hl-2">{number}</span><span class="hl-0"> </span><span class="hl-3">_price</span><span class="hl-0"> - Funko price</span><br/><span class="hl-0"> */</span><br/><span class="hl-4">export</span><span class="hl-5"> </span><span class="hl-1">interface</span><span class="hl-5"> </span><span class="hl-2">Funko</span><span class="hl-5"> {</span><br/><span class="hl-5">  </span><span class="hl-3">_owner</span><span class="hl-5">: </span><span class="hl-2">string</span><span class="hl-5">;</span><br/><span class="hl-5">  </span><span class="hl-3">_id</span><span class="hl-5">?: </span><span class="hl-2">string</span><span class="hl-5">;</span><br/><span class="hl-5">  </span><span class="hl-3">_name</span><span class="hl-5">?: </span><span class="hl-2">string</span><span class="hl-5">;</span><br/><span class="hl-5">  </span><span class="hl-3">_description</span><span class="hl-5">?: </span><span class="hl-2">string</span><span class="hl-5">;</span><br/><span class="hl-5">  </span><span class="hl-3">_type</span><span class="hl-5">?: </span><span class="hl-2">string</span><span class="hl-5">;</span><br/><span class="hl-5">  </span><span class="hl-3">_genre</span><span class="hl-5">?: </span><span class="hl-2">string</span><span class="hl-5">;</span><br/><span class="hl-5">  </span><span class="hl-3">_franchise</span><span class="hl-5">?: </span><span class="hl-2">string</span><span class="hl-5">;</span><br/><span class="hl-5">  </span><span class="hl-3">_franchise_number</span><span class="hl-5">?: </span><span class="hl-2">string</span><span class="hl-5">;</span><br/><span class="hl-5">  </span><span class="hl-3">_exclusive</span><span class="hl-5">?: </span><span class="hl-2">string</span><span class="hl-5">;</span><br/><span class="hl-5">  </span><span class="hl-3">_especialCaracteristics</span><span class="hl-5">?: </span><span class="hl-2">string</span><span class="hl-5">;</span><br/><span class="hl-5">  </span><span class="hl-3">_price</span><span class="hl-5">?: </span><span class="hl-2">string</span><span class="hl-5">;</span><br/><span class="hl-5">}</span>
</code></pre>
<p>Esta interfaz es la que recoge todas las propiedades de un funko. Se ha añadido una propiedad _owner que recoge el id del usuario que ha creado el funko.</p>
<p>Tipos instanciados para la aplicacion:</p>
<pre><code class="language-ts"><span class="hl-0">/**</span><br/><span class="hl-0"> * </span><span class="hl-1">@description</span><span class="hl-0"> Response type</span><br/><span class="hl-0"> */</span><br/><span class="hl-4">export</span><span class="hl-5"> </span><span class="hl-1">type</span><span class="hl-5"> </span><span class="hl-2">ResponseType</span><span class="hl-5"> = {</span><br/><span class="hl-5">  </span><span class="hl-3">type</span><span class="hl-5">: </span><span class="hl-6">&#39;add&#39;</span><span class="hl-5"> | </span><span class="hl-6">&#39;update&#39;</span><span class="hl-5"> | </span><span class="hl-6">&#39;remove&#39;</span><span class="hl-5"> | </span><span class="hl-6">&#39;read&#39;</span><span class="hl-5"> | </span><span class="hl-6">&#39;list&#39;</span><span class="hl-5"> | </span><span class="hl-6">&#39;error&#39;</span><span class="hl-5">;</span><br/><span class="hl-5">  </span><span class="hl-3">success</span><span class="hl-5">: </span><span class="hl-2">boolean</span><span class="hl-5">;</span><br/><span class="hl-5">  </span><span class="hl-3">message</span><span class="hl-5">: </span><span class="hl-2">string</span><span class="hl-5">;</span><br/><span class="hl-5">  </span><span class="hl-3">funko</span><span class="hl-5">?: </span><span class="hl-2">Funko</span><span class="hl-5">;</span><br/><span class="hl-5">  </span><span class="hl-3">funkoPops</span><span class="hl-5">?: </span><span class="hl-2">Funko</span><span class="hl-5">[];</span><br/><span class="hl-5">}</span>
</code></pre>
<p><em>ResponseType</em> es un tipo que recoge los tipos de respuesta que puede devolver el servidor. </p>
<p>Funciones utilizadas para el desempeño de la aplicacion:</p>
<pre><code class="language-ts"><span class="hl-0">/**</span><br/><span class="hl-0"> * </span><span class="hl-1">@description</span><span class="hl-0"> Función que comprueba si un usuario existe en la base de datos</span><br/><span class="hl-0"> * </span><span class="hl-1">@description</span><span class="hl-0"> Haciendo uso de lo aprendido en el ejercicio 1 de esta práctica</span><br/><span class="hl-0"> * </span><span class="hl-1">@param</span><span class="hl-0"> </span><span class="hl-3">filePath</span><span class="hl-0"> </span><br/><span class="hl-0"> * </span><span class="hl-1">@param</span><span class="hl-0"> </span><span class="hl-3">callback</span><span class="hl-0"> </span><br/><span class="hl-0"> */</span><br/><span class="hl-4">export</span><span class="hl-5"> </span><span class="hl-1">function</span><span class="hl-5"> </span><span class="hl-7">userExistOnBD</span><span class="hl-5">(</span><span class="hl-3">filePath</span><span class="hl-5">: </span><span class="hl-2">string</span><span class="hl-5">, </span><span class="hl-7">callback</span><span class="hl-5">: (</span><span class="hl-3">exists</span><span class="hl-5">: </span><span class="hl-2">boolean</span><span class="hl-5">) </span><span class="hl-1">=&gt;</span><span class="hl-5"> </span><span class="hl-2">void</span><span class="hl-5">): </span><span class="hl-2">void</span><span class="hl-5"> {</span><br/><span class="hl-5">  </span><span class="hl-3">fs</span><span class="hl-5">.</span><span class="hl-7">access</span><span class="hl-5">(</span><span class="hl-3">filePath</span><span class="hl-5">, </span><span class="hl-3">fs</span><span class="hl-5">.</span><span class="hl-3">constants</span><span class="hl-5">.</span><span class="hl-8">F_OK</span><span class="hl-5">, (</span><span class="hl-3">err</span><span class="hl-5">) </span><span class="hl-1">=&gt;</span><span class="hl-5"> {</span><br/><span class="hl-5">  </span><span class="hl-4">if</span><span class="hl-5"> (</span><span class="hl-3">err</span><span class="hl-5">) {</span><br/><span class="hl-5">    </span><span class="hl-7">callback</span><span class="hl-5">(</span><span class="hl-1">false</span><span class="hl-5">);</span><br/><span class="hl-5">  } </span><span class="hl-4">else</span><span class="hl-5"> {</span><br/><span class="hl-5">    </span><span class="hl-7">callback</span><span class="hl-5">(</span><span class="hl-1">true</span><span class="hl-5">);</span><br/><span class="hl-5">  }</span><br/><span class="hl-5">  });</span><br/><span class="hl-5">}</span><br/><br/><span class="hl-0">/**</span><br/><span class="hl-0"> * Función que lista los funkos de un usuario</span><br/><span class="hl-0"> * </span><span class="hl-1">@param</span><span class="hl-0"> </span><span class="hl-3">path</span><span class="hl-0"> -- Path donde se va a crear el funko</span><br/><span class="hl-0"> * </span><span class="hl-1">@param</span><span class="hl-0"> </span><span class="hl-3">user</span><span class="hl-0"> -- Usuario que crea el funko</span><br/><span class="hl-0"> */</span><br/><span class="hl-4">export</span><span class="hl-5"> </span><span class="hl-1">function</span><span class="hl-5"> </span><span class="hl-7">listFunko</span><span class="hl-5">(</span><span class="hl-3">path</span><span class="hl-5">: </span><span class="hl-2">string</span><span class="hl-5">, </span><span class="hl-3">user</span><span class="hl-5">: </span><span class="hl-2">string</span><span class="hl-5">): </span><span class="hl-2">Funko</span><span class="hl-5">[] {</span><br/><span class="hl-5">  </span><span class="hl-1">const</span><span class="hl-5"> </span><span class="hl-8">newPath</span><span class="hl-5"> = </span><span class="hl-6">`</span><span class="hl-1">${</span><span class="hl-3">path</span><span class="hl-1">}</span><span class="hl-6">/</span><span class="hl-1">${</span><span class="hl-3">user</span><span class="hl-1">}</span><span class="hl-6">`</span><span class="hl-5">;</span><br/><span class="hl-5">  </span><span class="hl-1">const</span><span class="hl-5"> </span><span class="hl-8">files</span><span class="hl-5"> = </span><span class="hl-3">fs</span><span class="hl-5">.</span><span class="hl-7">readdirSync</span><span class="hl-5">(</span><span class="hl-3">newPath</span><span class="hl-5">).</span><span class="hl-7">filter</span><span class="hl-5">((</span><span class="hl-3">file</span><span class="hl-5">) </span><span class="hl-1">=&gt;</span><span class="hl-5"> </span><span class="hl-3">file</span><span class="hl-5">.</span><span class="hl-7">endsWith</span><span class="hl-5">(</span><span class="hl-6">&#39;.json&#39;</span><span class="hl-5">));</span><br/><br/><span class="hl-5">  </span><span class="hl-1">const</span><span class="hl-5"> </span><span class="hl-8">funkos</span><span class="hl-5">: </span><span class="hl-2">Funko</span><span class="hl-5">[] = [];</span><br/><span class="hl-5">  </span><span class="hl-3">files</span><span class="hl-5">.</span><span class="hl-7">forEach</span><span class="hl-5">((</span><span class="hl-3">file</span><span class="hl-5">) </span><span class="hl-1">=&gt;</span><span class="hl-5"> {</span><br/><span class="hl-5">    </span><span class="hl-1">const</span><span class="hl-5"> </span><span class="hl-8">data</span><span class="hl-5"> = </span><span class="hl-3">fs</span><span class="hl-5">.</span><span class="hl-7">readFileSync</span><span class="hl-5">(</span><span class="hl-6">`</span><span class="hl-1">${</span><span class="hl-3">newPath</span><span class="hl-1">}</span><span class="hl-6">/</span><span class="hl-1">${</span><span class="hl-3">file</span><span class="hl-1">}</span><span class="hl-6">`</span><span class="hl-5">, </span><span class="hl-6">&#39;utf-8&#39;</span><span class="hl-5">);</span><br/><span class="hl-5">    </span><span class="hl-1">const</span><span class="hl-5"> </span><span class="hl-8">jsonData</span><span class="hl-5"> = </span><span class="hl-8">JSON</span><span class="hl-5">.</span><span class="hl-7">parse</span><span class="hl-5">(</span><span class="hl-3">data</span><span class="hl-5">);</span><br/><span class="hl-5">    </span><span class="hl-3">funkos</span><span class="hl-5">.</span><span class="hl-7">push</span><span class="hl-5">(</span><span class="hl-3">jsonData</span><span class="hl-5">);</span><br/><span class="hl-5">  });</span><br/><span class="hl-5">  </span><span class="hl-4">return</span><span class="hl-5"> </span><span class="hl-3">funkos</span><span class="hl-5">;</span><br/><span class="hl-5">}</span><br/><br/><span class="hl-0">/**</span><br/><span class="hl-0"> * </span><span class="hl-1">@description</span><span class="hl-0"> Función que busca un funko por su id</span><br/><span class="hl-0"> * </span><span class="hl-1">@param</span><span class="hl-0"> </span><span class="hl-3">path</span><span class="hl-0"> -- Path donde se va a crear el funko</span><br/><span class="hl-0"> * </span><span class="hl-1">@param</span><span class="hl-0"> </span><span class="hl-3">user</span><span class="hl-0"> -- Usuario que crea el funko</span><br/><span class="hl-0"> * </span><span class="hl-1">@param</span><span class="hl-0"> </span><span class="hl-3">id</span><span class="hl-0"> -- Id del funko</span><br/><span class="hl-0"> */</span><br/><span class="hl-4">export</span><span class="hl-5"> </span><span class="hl-1">function</span><span class="hl-5"> </span><span class="hl-7">findFunkoByID</span><span class="hl-5">(</span><span class="hl-3">path</span><span class="hl-5">: </span><span class="hl-2">string</span><span class="hl-5">, </span><span class="hl-3">user</span><span class="hl-5">: </span><span class="hl-2">string</span><span class="hl-5">, </span><span class="hl-3">id</span><span class="hl-5">: </span><span class="hl-2">string</span><span class="hl-5">): </span><span class="hl-2">Funko</span><span class="hl-5"> {</span><br/><span class="hl-5">  </span><span class="hl-1">const</span><span class="hl-5"> </span><span class="hl-8">newPath</span><span class="hl-5"> = </span><span class="hl-6">`</span><span class="hl-1">${</span><span class="hl-3">path</span><span class="hl-1">}</span><span class="hl-6">/</span><span class="hl-1">${</span><span class="hl-3">user</span><span class="hl-1">}</span><span class="hl-6">`</span><span class="hl-5">;</span><br/><span class="hl-5">  </span><span class="hl-1">let</span><span class="hl-5"> </span><span class="hl-3">funko</span><span class="hl-5">: </span><span class="hl-2">Funko</span><span class="hl-5"> = {</span><br/><span class="hl-5">    </span><span class="hl-3">_owner:</span><span class="hl-5"> </span><span class="hl-3">user</span><span class="hl-5">,</span><br/><span class="hl-5">    </span><span class="hl-3">_description:</span><span class="hl-5"> </span><span class="hl-6">&#39;Se ha decidido buscar un funko por su id&#39;</span><span class="hl-5">,</span><br/><span class="hl-5">  }</span><br/><br/><span class="hl-5">  </span><span class="hl-1">const</span><span class="hl-5"> </span><span class="hl-8">files</span><span class="hl-5"> = </span><span class="hl-3">fs</span><span class="hl-5">.</span><span class="hl-7">readdirSync</span><span class="hl-5">(</span><span class="hl-3">newPath</span><span class="hl-5">).</span><span class="hl-7">filter</span><span class="hl-5">((</span><span class="hl-3">file</span><span class="hl-5">) </span><span class="hl-1">=&gt;</span><span class="hl-5"> </span><span class="hl-3">file</span><span class="hl-5">.</span><span class="hl-7">endsWith</span><span class="hl-5">(</span><span class="hl-6">&#39;.json&#39;</span><span class="hl-5">));</span><br/><span class="hl-5">    </span><span class="hl-3">files</span><span class="hl-5">.</span><span class="hl-7">forEach</span><span class="hl-5">((</span><span class="hl-3">file</span><span class="hl-5">) </span><span class="hl-1">=&gt;</span><span class="hl-5"> {</span><br/><span class="hl-5">      </span><span class="hl-1">const</span><span class="hl-5"> </span><span class="hl-8">data</span><span class="hl-5"> = </span><span class="hl-3">fs</span><span class="hl-5">.</span><span class="hl-7">readFileSync</span><span class="hl-5">(</span><span class="hl-6">`</span><span class="hl-1">${</span><span class="hl-3">newPath</span><span class="hl-1">}</span><span class="hl-6">/</span><span class="hl-1">${</span><span class="hl-3">file</span><span class="hl-1">}</span><span class="hl-6">`</span><span class="hl-5">, </span><span class="hl-6">&#39;utf-8&#39;</span><span class="hl-5">);</span><br/><span class="hl-5">      </span><span class="hl-1">const</span><span class="hl-5"> </span><span class="hl-8">jsonData</span><span class="hl-5"> = </span><span class="hl-8">JSON</span><span class="hl-5">.</span><span class="hl-7">parse</span><span class="hl-5">(</span><span class="hl-3">data</span><span class="hl-5">);</span><br/><br/><span class="hl-5">      </span><span class="hl-4">if</span><span class="hl-5"> (</span><span class="hl-3">jsonData</span><span class="hl-5">.</span><span class="hl-3">id</span><span class="hl-5"> === </span><span class="hl-3">id</span><span class="hl-5">) {</span><br/><span class="hl-5">        </span><span class="hl-3">funko</span><span class="hl-5"> = </span><span class="hl-3">jsonData</span><span class="hl-5">;</span><br/><span class="hl-5">      }</span><br/><span class="hl-5">  });</span><br/><span class="hl-5">  </span><span class="hl-4">return</span><span class="hl-5"> </span><span class="hl-3">funko</span><span class="hl-5">;</span><br/><span class="hl-5">}</span><br/><br/><span class="hl-0">/**</span><br/><span class="hl-0"> * </span><span class="hl-1">@description</span><span class="hl-0"> Función que genera un fichero JSON con la información del funko</span><br/><span class="hl-0"> * </span><span class="hl-1">@param</span><span class="hl-0"> </span><span class="hl-3">funko</span><span class="hl-0"> </span><br/><span class="hl-0"> */</span><br/><span class="hl-0">// eslint-disable-next-line @typescript-eslint/no-explicit-any</span><br/><span class="hl-4">export</span><span class="hl-5"> </span><span class="hl-1">function</span><span class="hl-5"> </span><span class="hl-7">createJsonFunkoFile</span><span class="hl-5">(</span><span class="hl-3">user</span><span class="hl-5">:</span><span class="hl-2">string</span><span class="hl-5">, </span><span class="hl-3">funko</span><span class="hl-5">: </span><span class="hl-2">Funko</span><span class="hl-5">): </span><span class="hl-2">void</span><span class="hl-5"> {</span><br/><span class="hl-5">  </span><span class="hl-1">const</span><span class="hl-5"> </span><span class="hl-8">datosJSON</span><span class="hl-5"> = </span><span class="hl-8">JSON</span><span class="hl-5">.</span><span class="hl-7">stringify</span><span class="hl-5">(</span><span class="hl-3">funko</span><span class="hl-5">);</span><br/><span class="hl-5">  </span><span class="hl-0">// creamos el path donde se va a crear el fichero con el nombre del funko y extension .json</span><br/><span class="hl-5">  </span><span class="hl-1">const</span><span class="hl-5"> </span><span class="hl-8">newPath</span><span class="hl-5"> = </span><span class="hl-6">`./database/</span><span class="hl-1">${</span><span class="hl-3">user</span><span class="hl-1">}</span><span class="hl-6">/</span><span class="hl-1">${</span><span class="hl-3">funko</span><span class="hl-9">.</span><span class="hl-3">_name</span><span class="hl-1">}</span><span class="hl-6">.json`</span><span class="hl-5">; </span><br/><br/><span class="hl-5">  </span><span class="hl-3">fs</span><span class="hl-5">.</span><span class="hl-7">writeFileSync</span><span class="hl-5">(</span><span class="hl-3">newPath</span><span class="hl-5">, </span><span class="hl-3">datosJSON</span><span class="hl-5">);</span><br/><span class="hl-5">}</span><br/><br/><span class="hl-0">/**</span><br/><span class="hl-0"> * </span><span class="hl-1">@description</span><span class="hl-0"> Función que borra un funko por su id</span><br/><span class="hl-0"> * </span><span class="hl-1">@param</span><span class="hl-0"> </span><span class="hl-3">path</span><span class="hl-0"> -- Path donde se va a crear el funko</span><br/><span class="hl-0"> * </span><span class="hl-1">@param</span><span class="hl-0"> </span><span class="hl-3">user</span><span class="hl-0"> -- Usuario que crea el funko</span><br/><span class="hl-0"> * </span><span class="hl-1">@param</span><span class="hl-0"> </span><span class="hl-3">id</span><span class="hl-0"> -- Id del funko</span><br/><span class="hl-0"> * </span><br/><span class="hl-0"> */</span><br/><span class="hl-4">export</span><span class="hl-5"> </span><span class="hl-1">function</span><span class="hl-5"> </span><span class="hl-7">removeFunko</span><span class="hl-5">(</span><span class="hl-3">path</span><span class="hl-5">: </span><span class="hl-2">string</span><span class="hl-5">, </span><span class="hl-3">user</span><span class="hl-5">: </span><span class="hl-2">string</span><span class="hl-5">, </span><span class="hl-3">id</span><span class="hl-5">: </span><span class="hl-2">string</span><span class="hl-5">): </span><span class="hl-2">boolean</span><span class="hl-5">{</span><br/><span class="hl-5">  </span><span class="hl-1">const</span><span class="hl-5"> </span><span class="hl-8">newPath</span><span class="hl-5"> = </span><span class="hl-6">`</span><span class="hl-1">${</span><span class="hl-3">path</span><span class="hl-1">}</span><span class="hl-6">/</span><span class="hl-1">${</span><span class="hl-3">user</span><span class="hl-1">}</span><span class="hl-6">`</span><span class="hl-5">;</span><br/><span class="hl-5">  </span><span class="hl-1">const</span><span class="hl-5"> </span><span class="hl-8">ids</span><span class="hl-5"> = </span><span class="hl-7">getIds</span><span class="hl-5">(</span><span class="hl-3">newPath</span><span class="hl-5">);</span><br/><br/><span class="hl-5">  </span><span class="hl-4">if</span><span class="hl-5"> (</span><span class="hl-7">checkIds</span><span class="hl-5">(</span><span class="hl-3">ids</span><span class="hl-5">, </span><span class="hl-3">id</span><span class="hl-5">)) {</span><br/><span class="hl-5">    </span><span class="hl-1">const</span><span class="hl-5"> </span><span class="hl-8">files</span><span class="hl-5"> = </span><span class="hl-3">fs</span><span class="hl-5">.</span><span class="hl-7">readdirSync</span><span class="hl-5">(</span><span class="hl-3">newPath</span><span class="hl-5">).</span><span class="hl-7">filter</span><span class="hl-5">((</span><span class="hl-3">file</span><span class="hl-5">) </span><span class="hl-1">=&gt;</span><span class="hl-5"> </span><span class="hl-3">file</span><span class="hl-5">.</span><span class="hl-7">endsWith</span><span class="hl-5">(</span><span class="hl-6">&#39;.json&#39;</span><span class="hl-5">));</span><br/><span class="hl-5">    </span><span class="hl-3">files</span><span class="hl-5">.</span><span class="hl-7">forEach</span><span class="hl-5">((</span><span class="hl-3">file</span><span class="hl-5">) </span><span class="hl-1">=&gt;</span><span class="hl-5"> {</span><br/><span class="hl-5">      </span><span class="hl-1">const</span><span class="hl-5"> </span><span class="hl-8">data</span><span class="hl-5"> = </span><span class="hl-3">fs</span><span class="hl-5">.</span><span class="hl-7">readFileSync</span><span class="hl-5">(</span><span class="hl-6">`</span><span class="hl-1">${</span><span class="hl-3">newPath</span><span class="hl-1">}</span><span class="hl-6">/</span><span class="hl-1">${</span><span class="hl-3">file</span><span class="hl-1">}</span><span class="hl-6">`</span><span class="hl-5">, </span><span class="hl-6">&#39;utf-8&#39;</span><span class="hl-5">);</span><br/><span class="hl-5">      </span><span class="hl-1">const</span><span class="hl-5"> </span><span class="hl-8">jsonData</span><span class="hl-5"> = </span><span class="hl-8">JSON</span><span class="hl-5">.</span><span class="hl-7">parse</span><span class="hl-5">(</span><span class="hl-3">data</span><span class="hl-5">);</span><br/><br/><span class="hl-5">      </span><span class="hl-4">if</span><span class="hl-5"> (</span><span class="hl-3">jsonData</span><span class="hl-5">.</span><span class="hl-3">_id</span><span class="hl-5"> == </span><span class="hl-3">id</span><span class="hl-5">) {</span><br/><span class="hl-5">        </span><span class="hl-0">// console.log(&quot;Entra aqui&quot;)</span><br/><span class="hl-5">        </span><span class="hl-1">const</span><span class="hl-5"> </span><span class="hl-8">newpath_and_file</span><span class="hl-5"> = </span><span class="hl-6">`</span><span class="hl-1">${</span><span class="hl-3">newPath</span><span class="hl-1">}</span><span class="hl-6">/</span><span class="hl-1">${</span><span class="hl-3">file</span><span class="hl-1">}</span><span class="hl-6">`</span><span class="hl-5">;</span><br/><span class="hl-5">        </span><span class="hl-0">//console.log(&quot;borra&quot;)</span><br/><span class="hl-5">        </span><span class="hl-3">fs</span><span class="hl-5">.</span><span class="hl-7">unlinkSync</span><span class="hl-5">(</span><span class="hl-3">newpath_and_file</span><span class="hl-5">);</span><br/><span class="hl-5">      }</span><br/><span class="hl-5">    });</span><br/><span class="hl-5">    </span><span class="hl-0">// console.log(&quot;Funko eliminado correctamente&quot;);</span><br/><span class="hl-5">    </span><span class="hl-4">return</span><span class="hl-5"> </span><span class="hl-1">true</span><span class="hl-5">;</span><br/><span class="hl-5">  } </span><span class="hl-4">else</span><span class="hl-5"> {</span><br/><span class="hl-5">    </span><span class="hl-4">return</span><span class="hl-5"> </span><span class="hl-1">false</span><span class="hl-5">;</span><br/><span class="hl-5">  }</span><br/><span class="hl-5">}</span><br/><br/><span class="hl-0">/**</span><br/><span class="hl-0"> * </span><span class="hl-1">@description</span><span class="hl-0"> Función que comprueba si el id del funko es unico</span><br/><span class="hl-0"> * </span><span class="hl-1">@param</span><span class="hl-0"> </span><span class="hl-3">path</span><span class="hl-0"> -- Path donde se va a crear el funko</span><br/><span class="hl-0"> */</span><br/><span class="hl-4">export</span><span class="hl-5"> </span><span class="hl-1">function</span><span class="hl-5"> </span><span class="hl-7">getIds</span><span class="hl-5">(</span><span class="hl-3">path</span><span class="hl-5">:</span><span class="hl-2">string</span><span class="hl-5">): </span><span class="hl-2">string</span><span class="hl-5">[] {</span><br/><span class="hl-5">  </span><span class="hl-1">const</span><span class="hl-5"> </span><span class="hl-8">files</span><span class="hl-5"> = </span><span class="hl-3">fs</span><span class="hl-5">.</span><span class="hl-7">readdirSync</span><span class="hl-5">(</span><span class="hl-3">path</span><span class="hl-5">).</span><span class="hl-7">filter</span><span class="hl-5">((</span><span class="hl-3">file</span><span class="hl-5">) </span><span class="hl-1">=&gt;</span><span class="hl-5"> </span><span class="hl-3">file</span><span class="hl-5">.</span><span class="hl-7">endsWith</span><span class="hl-5">(</span><span class="hl-6">&#39;.json&#39;</span><span class="hl-5">)); </span><span class="hl-0">// nos aseguramos que los ficheros leidos son solo los .json, para curarme en salud</span><br/><span class="hl-5">  </span><span class="hl-1">const</span><span class="hl-5"> </span><span class="hl-8">ids</span><span class="hl-5">: </span><span class="hl-2">string</span><span class="hl-5">[] = []; </span><span class="hl-0">// array donde almacenaremos los ids de los funkos del usuario</span><br/><br/><span class="hl-5">  </span><span class="hl-3">files</span><span class="hl-5">.</span><span class="hl-7">forEach</span><span class="hl-5">((</span><span class="hl-3">file</span><span class="hl-5">) </span><span class="hl-1">=&gt;</span><span class="hl-5"> {</span><br/><span class="hl-5">    </span><span class="hl-1">const</span><span class="hl-5"> </span><span class="hl-8">content</span><span class="hl-5"> = </span><span class="hl-3">fs</span><span class="hl-5">.</span><span class="hl-7">readFileSync</span><span class="hl-5">(</span><span class="hl-6">`</span><span class="hl-1">${</span><span class="hl-3">path</span><span class="hl-1">}</span><span class="hl-6">/</span><span class="hl-1">${</span><span class="hl-3">file</span><span class="hl-1">}</span><span class="hl-6">`</span><span class="hl-5">);</span><br/><span class="hl-5">    </span><span class="hl-1">const</span><span class="hl-5"> </span><span class="hl-8">funkoData</span><span class="hl-5"> = </span><span class="hl-8">JSON</span><span class="hl-5">.</span><span class="hl-7">parse</span><span class="hl-5">(</span><span class="hl-3">content</span><span class="hl-5">.</span><span class="hl-7">toString</span><span class="hl-5">());</span><br/><span class="hl-5">    </span><span class="hl-0">// console.log(funkoData.id);</span><br/><span class="hl-5">    </span><span class="hl-3">ids</span><span class="hl-5">.</span><span class="hl-7">push</span><span class="hl-5">(</span><span class="hl-3">funkoData</span><span class="hl-5">.</span><span class="hl-3">_id</span><span class="hl-5">);</span><br/><span class="hl-5">  });</span><br/><br/><span class="hl-5">  </span><span class="hl-0">// console.log(ids);</span><br/><span class="hl-5">  </span><span class="hl-4">return</span><span class="hl-5"> </span><span class="hl-3">ids</span><span class="hl-5">;</span><br/><span class="hl-5">}</span><br/><br/><span class="hl-0">/**</span><br/><span class="hl-0"> * </span><span class="hl-1">@description</span><span class="hl-0"> Función que comprueba si el id del funko es unico</span><br/><span class="hl-0"> * </span><span class="hl-1">@param</span><span class="hl-0"> </span><span class="hl-3">path</span><span class="hl-0"> -- Path donde se va a crear el funko</span><br/><span class="hl-0"> */</span><br/><span class="hl-4">export</span><span class="hl-5"> </span><span class="hl-1">function</span><span class="hl-5"> </span><span class="hl-7">checkValidCmd</span><span class="hl-5">(</span><span class="hl-3">cmd</span><span class="hl-5">: </span><span class="hl-2">string</span><span class="hl-5">): </span><span class="hl-2">boolean</span><span class="hl-5"> {</span><br/><span class="hl-5">  </span><span class="hl-4">if</span><span class="hl-5"> (</span><span class="hl-3">cmd</span><span class="hl-5"> === </span><span class="hl-6">&#39;get&#39;</span><span class="hl-5"> || </span><span class="hl-3">cmd</span><span class="hl-5"> === </span><span class="hl-6">&#39;post&#39;</span><span class="hl-5"> || </span><span class="hl-3">cmd</span><span class="hl-5"> === </span><span class="hl-6">&#39;delete&#39;</span><span class="hl-5"> || </span><span class="hl-3">cmd</span><span class="hl-5"> === </span><span class="hl-6">&#39;patch&#39;</span><span class="hl-5">) {</span><br/><span class="hl-5">    </span><span class="hl-4">return</span><span class="hl-5"> </span><span class="hl-1">true</span><span class="hl-5">;</span><br/><span class="hl-5">  }</span><br/><span class="hl-5">  </span><span class="hl-4">return</span><span class="hl-5"> </span><span class="hl-1">false</span><span class="hl-5">;</span><br/><span class="hl-5">}</span><br/><br/><span class="hl-0">/**</span><br/><span class="hl-0"> * </span><span class="hl-1">@description</span><span class="hl-0"> Función que comprueba si el id del funko existe en el array de ids</span><br/><span class="hl-0"> */</span><br/><span class="hl-4">export</span><span class="hl-5"> </span><span class="hl-1">function</span><span class="hl-5"> </span><span class="hl-7">checkIds</span><span class="hl-5">(</span><span class="hl-3">ids</span><span class="hl-5">: </span><span class="hl-2">string</span><span class="hl-5">[], </span><span class="hl-3">id</span><span class="hl-5">: </span><span class="hl-2">string</span><span class="hl-5">): </span><span class="hl-2">boolean</span><span class="hl-5"> {</span><br/><span class="hl-5">  </span><span class="hl-4">for</span><span class="hl-5"> (</span><span class="hl-1">let</span><span class="hl-5"> </span><span class="hl-3">i</span><span class="hl-5"> = </span><span class="hl-10">0</span><span class="hl-5">; </span><span class="hl-3">i</span><span class="hl-5"> &lt; </span><span class="hl-3">ids</span><span class="hl-5">.</span><span class="hl-3">length</span><span class="hl-5">; </span><span class="hl-3">i</span><span class="hl-5">++) {</span><br/><span class="hl-5">    </span><span class="hl-0">//console.log( ids[i] + &quot; &quot; + id)</span><br/><span class="hl-5">    </span><span class="hl-4">if</span><span class="hl-5"> (</span><span class="hl-3">ids</span><span class="hl-5">[</span><span class="hl-3">i</span><span class="hl-5">] == </span><span class="hl-3">id</span><span class="hl-5">) {</span><br/><span class="hl-5">      </span><span class="hl-4">return</span><span class="hl-5"> </span><span class="hl-1">true</span><span class="hl-5">;</span><br/><span class="hl-5">    }</span><br/><span class="hl-5">  }</span><br/><span class="hl-5">  </span><span class="hl-4">return</span><span class="hl-5"> </span><span class="hl-1">false</span><span class="hl-5">;</span><br/><span class="hl-5">}</span><br/><br/><span class="hl-0">/**</span><br/><span class="hl-0"> * </span><span class="hl-1">@Description</span><span class="hl-0"> Funcion que verifica si existe un directorio con el nombre del usuario en la base de datos</span><br/><span class="hl-0"> * </span><span class="hl-1">@param</span><span class="hl-0"> </span><span class="hl-3">userNAme</span><span class="hl-0"> -- Nombre del usuario</span><br/><span class="hl-0"> * </span><span class="hl-1">@param</span><span class="hl-0"> </span><span class="hl-3">path</span><span class="hl-0"> -- Path donde se va a buscar el directorio</span><br/><span class="hl-0"> */</span><br/><span class="hl-4">export</span><span class="hl-5"> </span><span class="hl-1">function</span><span class="hl-5"> </span><span class="hl-7">checkUserDirSync</span><span class="hl-5">(</span><span class="hl-3">userName</span><span class="hl-5">: </span><span class="hl-2">string</span><span class="hl-5">, </span><span class="hl-3">path</span><span class="hl-5">: </span><span class="hl-2">string</span><span class="hl-5">) : </span><span class="hl-2">boolean</span><span class="hl-5"> {</span><br/><span class="hl-5">  </span><span class="hl-0">// Leemos el directorio y almacenamos en una variable los archivos dentro de ella</span><br/><span class="hl-5">  </span><span class="hl-0">//? Tener en cuenta que pueden ser carpetas o archivos, para no olvidarme de manejar esto despues... </span><br/><span class="hl-5">  </span><span class="hl-1">const</span><span class="hl-5"> </span><span class="hl-8">pathDirectories</span><span class="hl-5"> = </span><span class="hl-3">fs</span><span class="hl-5">.</span><span class="hl-7">readdirSync</span><span class="hl-5">(</span><span class="hl-3">path</span><span class="hl-5">); </span><br/><br/><span class="hl-5">  </span><span class="hl-0">// variable booleana para retornar si existe o no el directorio</span><br/><span class="hl-5">  </span><span class="hl-0">//? lstatSync Mediante esta funcion podemos saber si es un directorio o un archivo, en caso de ser un archivo se retornara false</span><br/><span class="hl-5">  </span><span class="hl-1">const</span><span class="hl-5"> </span><span class="hl-8">existDir</span><span class="hl-5"> = </span><span class="hl-3">pathDirectories</span><span class="hl-5">.</span><span class="hl-7">some</span><span class="hl-5">((</span><span class="hl-3">dir</span><span class="hl-5">) </span><span class="hl-1">=&gt;</span><span class="hl-5"> </span><span class="hl-3">dir</span><span class="hl-5"> === </span><span class="hl-3">userName</span><span class="hl-5"> &amp;&amp; </span><span class="hl-3">fs</span><span class="hl-5">.</span><span class="hl-7">lstatSync</span><span class="hl-5">(</span><span class="hl-6">`</span><span class="hl-1">${</span><span class="hl-3">path</span><span class="hl-1">}</span><span class="hl-6">/</span><span class="hl-1">${</span><span class="hl-3">dir</span><span class="hl-1">}</span><span class="hl-6">`</span><span class="hl-5">).</span><span class="hl-7">isDirectory</span><span class="hl-5">()) </span><br/><br/><span class="hl-5">  </span><span class="hl-4">return</span><span class="hl-5"> </span><span class="hl-3">existDir</span><span class="hl-5">;</span><br/><span class="hl-5">}</span>
</code></pre>
<p>Estas han sido las funciones usadas para la gestión de ficheros y directorios. Son las utilizadas en las prácticas anteriores por lo que ya han sido explicadas en sus correspondientes informes.</p>
<p>Finalmente tenemos el código del servidor express:</p>
<pre><code class="language-ts"><span class="hl-1">const</span><span class="hl-5"> </span><span class="hl-8">app</span><span class="hl-5"> = </span><span class="hl-7">express</span><span class="hl-5">();</span><br/><br/><span class="hl-3">app</span><span class="hl-5">.</span><span class="hl-7">get</span><span class="hl-5">(</span><span class="hl-6">&#39;/funkos&#39;</span><span class="hl-5">, (</span><span class="hl-3">req</span><span class="hl-5">, </span><span class="hl-3">res</span><span class="hl-5">) </span><span class="hl-1">=&gt;</span><span class="hl-5"> {</span><br/><span class="hl-5">  </span><span class="hl-0">// const args:string = req.query.args as string;</span><br/><span class="hl-5">  </span><span class="hl-1">const</span><span class="hl-5"> </span><span class="hl-8">cmd</span><span class="hl-5"> = </span><span class="hl-3">req</span><span class="hl-5">.</span><span class="hl-3">query</span><span class="hl-5">.</span><span class="hl-3">cmd</span><span class="hl-5"> </span><span class="hl-4">as</span><span class="hl-5"> </span><span class="hl-2">string</span><span class="hl-5">;</span><br/><span class="hl-5">  </span><span class="hl-1">const</span><span class="hl-5"> </span><span class="hl-8">user</span><span class="hl-5"> = </span><span class="hl-3">req</span><span class="hl-5">.</span><span class="hl-3">query</span><span class="hl-5">.</span><span class="hl-3">user</span><span class="hl-5"> </span><span class="hl-4">as</span><span class="hl-5"> </span><span class="hl-2">string</span><span class="hl-5">;</span><br/><span class="hl-5">  </span><span class="hl-1">const</span><span class="hl-5"> </span><span class="hl-8">id</span><span class="hl-5"> = </span><span class="hl-3">req</span><span class="hl-5">.</span><span class="hl-3">query</span><span class="hl-5">.</span><span class="hl-3">id</span><span class="hl-5"> </span><span class="hl-4">as</span><span class="hl-5"> </span><span class="hl-2">string</span><span class="hl-5">;</span><br/><span class="hl-5">  </span><span class="hl-1">const</span><span class="hl-5"> </span><span class="hl-8">name</span><span class="hl-5"> = </span><span class="hl-3">req</span><span class="hl-5">.</span><span class="hl-3">query</span><span class="hl-5">.</span><span class="hl-3">name</span><span class="hl-5"> </span><span class="hl-4">as</span><span class="hl-5"> </span><span class="hl-2">string</span><span class="hl-5">;</span><br/><span class="hl-5">  </span><span class="hl-1">const</span><span class="hl-5"> </span><span class="hl-8">description</span><span class="hl-5"> = </span><span class="hl-3">req</span><span class="hl-5">.</span><span class="hl-3">query</span><span class="hl-5">.</span><span class="hl-3">description</span><span class="hl-5"> </span><span class="hl-4">as</span><span class="hl-5"> </span><span class="hl-2">string</span><span class="hl-5">;</span><br/><span class="hl-5">  </span><span class="hl-1">const</span><span class="hl-5"> </span><span class="hl-8">type</span><span class="hl-5"> = </span><span class="hl-3">req</span><span class="hl-5">.</span><span class="hl-3">query</span><span class="hl-5">.</span><span class="hl-3">type</span><span class="hl-5"> </span><span class="hl-4">as</span><span class="hl-5"> </span><span class="hl-2">string</span><span class="hl-5">;</span><br/><span class="hl-5">  </span><span class="hl-1">const</span><span class="hl-5"> </span><span class="hl-8">genre</span><span class="hl-5"> = </span><span class="hl-3">req</span><span class="hl-5">.</span><span class="hl-3">query</span><span class="hl-5">.</span><span class="hl-3">genre</span><span class="hl-5"> </span><span class="hl-4">as</span><span class="hl-5"> </span><span class="hl-2">string</span><span class="hl-5">;</span><br/><span class="hl-5">  </span><span class="hl-1">const</span><span class="hl-5"> </span><span class="hl-8">franchise</span><span class="hl-5"> = </span><span class="hl-3">req</span><span class="hl-5">.</span><span class="hl-3">query</span><span class="hl-5">.</span><span class="hl-3">franchise</span><span class="hl-5"> </span><span class="hl-4">as</span><span class="hl-5"> </span><span class="hl-2">string</span><span class="hl-5">;</span><br/><span class="hl-5">  </span><span class="hl-1">const</span><span class="hl-5"> </span><span class="hl-8">franchise_number</span><span class="hl-5"> = </span><span class="hl-3">req</span><span class="hl-5">.</span><span class="hl-3">query</span><span class="hl-5">.</span><span class="hl-3">franchise_number</span><span class="hl-5"> </span><span class="hl-4">as</span><span class="hl-5"> </span><span class="hl-2">string</span><span class="hl-5">;</span><br/><span class="hl-5">  </span><span class="hl-1">const</span><span class="hl-5"> </span><span class="hl-8">exclusive</span><span class="hl-5"> = </span><span class="hl-3">req</span><span class="hl-5">.</span><span class="hl-3">query</span><span class="hl-5">.</span><span class="hl-3">exclusive</span><span class="hl-5"> </span><span class="hl-4">as</span><span class="hl-5"> </span><span class="hl-2">string</span><span class="hl-5">;</span><br/><span class="hl-5">  </span><span class="hl-1">const</span><span class="hl-5"> </span><span class="hl-8">especialCar</span><span class="hl-5"> = </span><span class="hl-3">req</span><span class="hl-5">.</span><span class="hl-3">query</span><span class="hl-5">.</span><span class="hl-3">especialCar</span><span class="hl-5"> </span><span class="hl-4">as</span><span class="hl-5"> </span><span class="hl-2">string</span><span class="hl-5">;</span><br/><span class="hl-5">  </span><span class="hl-1">const</span><span class="hl-5"> </span><span class="hl-8">price</span><span class="hl-5"> = </span><span class="hl-3">req</span><span class="hl-5">.</span><span class="hl-3">query</span><span class="hl-5">.</span><span class="hl-3">price</span><span class="hl-5"> </span><span class="hl-4">as</span><span class="hl-5"> </span><span class="hl-2">string</span><span class="hl-5">;</span><br/><br/><span class="hl-5">  </span><span class="hl-0">// nos aseguramos de que llegue algún comando</span><br/><span class="hl-5">  </span><span class="hl-4">if</span><span class="hl-5"> (!</span><span class="hl-3">cmd</span><span class="hl-5">) {</span><br/><span class="hl-5">    </span><span class="hl-1">const</span><span class="hl-5"> </span><span class="hl-8">response</span><span class="hl-5">: </span><span class="hl-2">ResponseType</span><span class="hl-5"> = {</span><br/><span class="hl-5">      </span><span class="hl-3">type:</span><span class="hl-5"> </span><span class="hl-6">&#39;error&#39;</span><span class="hl-5">,</span><br/><span class="hl-5">      </span><span class="hl-3">success:</span><span class="hl-5"> </span><span class="hl-1">false</span><span class="hl-5">,</span><br/><span class="hl-5">      </span><span class="hl-3">message:</span><span class="hl-5"> </span><span class="hl-6">&#39;No se ha especificado el comando&#39;</span><span class="hl-5">,</span><br/><span class="hl-5">    };</span><br/><span class="hl-5">    </span><span class="hl-3">res</span><span class="hl-5">.</span><span class="hl-7">send</span><span class="hl-5">(</span><span class="hl-3">response</span><span class="hl-5">);</span><br/><span class="hl-5">    </span><span class="hl-4">return</span><span class="hl-5">;</span><br/><span class="hl-5">  }</span><br/><br/><span class="hl-5">  </span><span class="hl-4">if</span><span class="hl-5">(!</span><span class="hl-3">user</span><span class="hl-5">) {</span><br/><span class="hl-5">    </span><span class="hl-1">const</span><span class="hl-5"> </span><span class="hl-8">response</span><span class="hl-5">: </span><span class="hl-2">ResponseType</span><span class="hl-5"> = {</span><br/><span class="hl-5">      </span><span class="hl-3">type:</span><span class="hl-5"> </span><span class="hl-6">&#39;error&#39;</span><span class="hl-5">,</span><br/><span class="hl-5">      </span><span class="hl-3">success:</span><span class="hl-5"> </span><span class="hl-1">false</span><span class="hl-5">,</span><br/><span class="hl-5">      </span><span class="hl-3">message:</span><span class="hl-5"> </span><span class="hl-6">&#39;No se ha especificado el usuario&#39;</span><span class="hl-5">,</span><br/><span class="hl-5">    };</span><br/><span class="hl-5">    </span><span class="hl-3">res</span><span class="hl-5">.</span><span class="hl-7">send</span><span class="hl-5">(</span><span class="hl-3">response</span><span class="hl-5">);</span><br/><span class="hl-5">    </span><span class="hl-4">return</span><span class="hl-5">;</span><br/><span class="hl-5">  }</span><br/><br/><span class="hl-5">  </span><span class="hl-0">//? COMPROBAMOS QUE EL USUARIO EXISTE</span><br/><span class="hl-5">  </span><span class="hl-7">userExistOnBD</span><span class="hl-5">(</span><span class="hl-6">`./database/</span><span class="hl-1">${</span><span class="hl-3">user</span><span class="hl-1">}</span><span class="hl-6">`</span><span class="hl-5">, (</span><span class="hl-3">exists</span><span class="hl-5">) </span><span class="hl-1">=&gt;</span><span class="hl-5"> {</span><br/><span class="hl-5">    </span><span class="hl-4">if</span><span class="hl-5">(!</span><span class="hl-3">exists</span><span class="hl-5">) {</span><br/><span class="hl-5">      </span><span class="hl-1">const</span><span class="hl-5"> </span><span class="hl-8">response</span><span class="hl-5">: </span><span class="hl-2">ResponseType</span><span class="hl-5"> = {</span><br/><span class="hl-5">        </span><span class="hl-3">type:</span><span class="hl-5"> </span><span class="hl-6">&#39;error&#39;</span><span class="hl-5">,</span><br/><span class="hl-5">        </span><span class="hl-3">success:</span><span class="hl-5"> </span><span class="hl-1">false</span><span class="hl-5">,</span><br/><span class="hl-5">        </span><span class="hl-3">message:</span><span class="hl-5"> </span><span class="hl-6">&#39;El usuario no existe&#39;</span><span class="hl-5">,</span><br/><span class="hl-5">      };</span><br/><span class="hl-5">      </span><span class="hl-3">res</span><span class="hl-5">.</span><span class="hl-7">send</span><span class="hl-5">(</span><span class="hl-3">response</span><span class="hl-5">);</span><br/><span class="hl-5">      </span><span class="hl-4">return</span><span class="hl-5">;</span><br/><span class="hl-5">    } </span><span class="hl-4">else</span><span class="hl-5"> {</span><br/><span class="hl-5">      </span><span class="hl-0">// console.log(&quot;el usuario existe&quot;);</span><br/><span class="hl-5">    }</span><br/><span class="hl-5">  });</span><br/><br/><span class="hl-5">  </span><span class="hl-4">if</span><span class="hl-5"> (</span><span class="hl-7">checkValidCmd</span><span class="hl-5">(</span><span class="hl-3">cmd</span><span class="hl-5">)) {</span><br/><span class="hl-5">    </span><span class="hl-4">if</span><span class="hl-5">(</span><span class="hl-3">cmd</span><span class="hl-5"> === </span><span class="hl-6">&#39;post&#39;</span><span class="hl-5">) {</span><br/><span class="hl-5">      </span><span class="hl-1">const</span><span class="hl-5"> </span><span class="hl-8">funko</span><span class="hl-5">: </span><span class="hl-2">Funko</span><span class="hl-5"> = {</span><br/><span class="hl-5">        </span><span class="hl-3">_owner :</span><span class="hl-5"> </span><span class="hl-3">user</span><span class="hl-5">,</span><br/><span class="hl-5">        </span><span class="hl-3">_id:</span><span class="hl-5"> </span><span class="hl-3">id</span><span class="hl-5">,</span><br/><span class="hl-5">        </span><span class="hl-3">_name:</span><span class="hl-5"> </span><span class="hl-3">name</span><span class="hl-5">,</span><br/><span class="hl-5">        </span><span class="hl-3">_description:</span><span class="hl-5"> </span><span class="hl-3">description</span><span class="hl-5">,</span><br/><span class="hl-5">        </span><span class="hl-3">_type:</span><span class="hl-5"> </span><span class="hl-3">type</span><span class="hl-5">,</span><br/><span class="hl-5">        </span><span class="hl-3">_genre:</span><span class="hl-5"> </span><span class="hl-3">genre</span><span class="hl-5">,</span><br/><span class="hl-5">        </span><span class="hl-3">_franchise:</span><span class="hl-5"> </span><span class="hl-3">franchise</span><span class="hl-5">,</span><br/><span class="hl-5">        </span><span class="hl-3">_franchise_number:</span><span class="hl-5"> </span><span class="hl-3">franchise_number</span><span class="hl-5">,</span><br/><span class="hl-5">        </span><span class="hl-3">_exclusive:</span><span class="hl-5"> </span><span class="hl-3">exclusive</span><span class="hl-5">,</span><br/><span class="hl-5">        </span><span class="hl-3">_especialCaracteristics:</span><span class="hl-5"> </span><span class="hl-3">especialCar</span><span class="hl-5">,</span><br/><span class="hl-5">        </span><span class="hl-3">_price:</span><span class="hl-5"> </span><span class="hl-3">price</span><span class="hl-5">,</span><br/><span class="hl-5">      };</span><br/><span class="hl-5">      </span><span class="hl-7">postRequest</span><span class="hl-5">(</span><span class="hl-3">funko</span><span class="hl-5">, (</span><span class="hl-3">err</span><span class="hl-5">,</span><span class="hl-3">data</span><span class="hl-5">) </span><span class="hl-1">=&gt;</span><span class="hl-5"> {</span><br/><span class="hl-5">        </span><span class="hl-4">if</span><span class="hl-5">(</span><span class="hl-3">err</span><span class="hl-5">) {</span><br/><span class="hl-5">          </span><span class="hl-3">res</span><span class="hl-5">.</span><span class="hl-7">send</span><span class="hl-5">(</span><span class="hl-3">err</span><span class="hl-5">);</span><br/><span class="hl-5">          </span><span class="hl-4">return</span><span class="hl-5">;</span><br/><span class="hl-5">        } </span><span class="hl-4">else</span><span class="hl-5"> {</span><br/><span class="hl-5">          </span><span class="hl-3">res</span><span class="hl-5">.</span><span class="hl-7">send</span><span class="hl-5">(</span><span class="hl-3">data</span><span class="hl-5">);</span><br/><span class="hl-5">          </span><span class="hl-4">return</span><span class="hl-5">;</span><br/><span class="hl-5">        }</span><br/><span class="hl-5">      });</span><br/><span class="hl-5">    } </span><span class="hl-4">else</span><span class="hl-5"> </span><span class="hl-4">if</span><span class="hl-5">(</span><span class="hl-3">cmd</span><span class="hl-5"> === </span><span class="hl-6">&#39;delete&#39;</span><span class="hl-5">) {</span><br/><span class="hl-5">      </span><span class="hl-1">const</span><span class="hl-5"> </span><span class="hl-8">funko</span><span class="hl-5">: </span><span class="hl-2">Funko</span><span class="hl-5"> = {</span><br/><span class="hl-5">        </span><span class="hl-3">_owner :</span><span class="hl-5"> </span><span class="hl-3">user</span><span class="hl-5">,</span><br/><span class="hl-5">        </span><span class="hl-3">_id:</span><span class="hl-5"> </span><span class="hl-3">id</span><span class="hl-5">,</span><br/><span class="hl-5">      };</span><br/><span class="hl-5">      </span><span class="hl-7">deleteRequest</span><span class="hl-5">(</span><span class="hl-3">funko</span><span class="hl-5">, (</span><span class="hl-3">err</span><span class="hl-5">,</span><span class="hl-3">data</span><span class="hl-5">) </span><span class="hl-1">=&gt;</span><span class="hl-5"> {</span><br/><span class="hl-5">        </span><span class="hl-4">if</span><span class="hl-5">(</span><span class="hl-3">err</span><span class="hl-5">) {</span><br/><span class="hl-5">          </span><span class="hl-3">res</span><span class="hl-5">.</span><span class="hl-7">send</span><span class="hl-5">(</span><span class="hl-3">err</span><span class="hl-5">);</span><br/><span class="hl-5">          </span><span class="hl-4">return</span><span class="hl-5">;</span><br/><span class="hl-5">        } </span><span class="hl-4">else</span><span class="hl-5"> {</span><br/><span class="hl-5">          </span><span class="hl-3">res</span><span class="hl-5">.</span><span class="hl-7">send</span><span class="hl-5">(</span><span class="hl-3">data</span><span class="hl-5">);</span><br/><span class="hl-5">          </span><span class="hl-4">return</span><span class="hl-5">;</span><br/><span class="hl-5">        }</span><br/><span class="hl-5">      });</span><br/><span class="hl-5">    } </span><span class="hl-4">else</span><span class="hl-5"> </span><span class="hl-4">if</span><span class="hl-5"> (</span><span class="hl-3">cmd</span><span class="hl-5"> === </span><span class="hl-6">&#39;patch&#39;</span><span class="hl-5">) {</span><br/><span class="hl-5">      </span><span class="hl-1">const</span><span class="hl-5"> </span><span class="hl-8">funko</span><span class="hl-5">: </span><span class="hl-2">Funko</span><span class="hl-5"> = {</span><br/><span class="hl-5">        </span><span class="hl-3">_owner :</span><span class="hl-5"> </span><span class="hl-3">user</span><span class="hl-5">,</span><br/><span class="hl-5">        </span><span class="hl-3">_id:</span><span class="hl-5"> </span><span class="hl-3">id</span><span class="hl-5">,</span><br/><span class="hl-5">        </span><span class="hl-3">_name:</span><span class="hl-5"> </span><span class="hl-3">name</span><span class="hl-5">,</span><br/><span class="hl-5">        </span><span class="hl-3">_description:</span><span class="hl-5"> </span><span class="hl-3">description</span><span class="hl-5">,</span><br/><span class="hl-5">        </span><span class="hl-3">_type:</span><span class="hl-5"> </span><span class="hl-3">type</span><span class="hl-5">,</span><br/><span class="hl-5">        </span><span class="hl-3">_genre:</span><span class="hl-5"> </span><span class="hl-3">genre</span><span class="hl-5">,</span><br/><span class="hl-5">        </span><span class="hl-3">_franchise:</span><span class="hl-5"> </span><span class="hl-3">franchise</span><span class="hl-5">,</span><br/><span class="hl-5">        </span><span class="hl-3">_franchise_number:</span><span class="hl-5"> </span><span class="hl-3">franchise_number</span><span class="hl-5">,</span><br/><span class="hl-5">        </span><span class="hl-3">_exclusive:</span><span class="hl-5"> </span><span class="hl-3">exclusive</span><span class="hl-5">,</span><br/><span class="hl-5">        </span><span class="hl-3">_especialCaracteristics:</span><span class="hl-5"> </span><span class="hl-3">especialCar</span><span class="hl-5">,</span><br/><span class="hl-5">        </span><span class="hl-3">_price:</span><span class="hl-5"> </span><span class="hl-3">price</span><span class="hl-5">,</span><br/><span class="hl-5">      };</span><br/><span class="hl-5">      </span><span class="hl-7">patchRequest</span><span class="hl-5">(</span><span class="hl-3">funko</span><span class="hl-5">, (</span><span class="hl-3">err</span><span class="hl-5">,</span><span class="hl-3">data</span><span class="hl-5">) </span><span class="hl-1">=&gt;</span><span class="hl-5"> {</span><br/><span class="hl-5">        </span><span class="hl-4">if</span><span class="hl-5">(</span><span class="hl-3">err</span><span class="hl-5">) {</span><br/><span class="hl-5">          </span><span class="hl-3">res</span><span class="hl-5">.</span><span class="hl-7">send</span><span class="hl-5">(</span><span class="hl-3">err</span><span class="hl-5">);</span><br/><span class="hl-5">          </span><span class="hl-4">return</span><span class="hl-5">;</span><br/><span class="hl-5">        } </span><span class="hl-4">else</span><span class="hl-5"> {</span><br/><span class="hl-5">          </span><span class="hl-3">res</span><span class="hl-5">.</span><span class="hl-7">send</span><span class="hl-5">(</span><span class="hl-3">data</span><span class="hl-5">);</span><br/><span class="hl-5">          </span><span class="hl-4">return</span><span class="hl-5">;</span><br/><span class="hl-5">        }</span><br/><span class="hl-5">      });</span><br/><span class="hl-5">    } </span><span class="hl-4">else</span><span class="hl-5"> </span><span class="hl-4">if</span><span class="hl-5">(</span><span class="hl-3">cmd</span><span class="hl-5"> === </span><span class="hl-6">&#39;get&#39;</span><span class="hl-5">) {</span><br/><span class="hl-5">      </span><span class="hl-4">if</span><span class="hl-5"> (!</span><span class="hl-3">id</span><span class="hl-5">) {</span><br/><span class="hl-5">        </span><span class="hl-1">const</span><span class="hl-5"> </span><span class="hl-8">funko</span><span class="hl-5">: </span><span class="hl-2">Funko</span><span class="hl-5"> = {</span><br/><span class="hl-5">          </span><span class="hl-3">_owner :</span><span class="hl-5"> </span><span class="hl-3">user</span><span class="hl-5">,</span><br/><span class="hl-5">        };</span><br/><span class="hl-5">        </span><span class="hl-7">getListRequest</span><span class="hl-5">(</span><span class="hl-3">funko</span><span class="hl-5">, (</span><span class="hl-3">err</span><span class="hl-5">,</span><span class="hl-3">data</span><span class="hl-5">) </span><span class="hl-1">=&gt;</span><span class="hl-5"> {</span><br/><span class="hl-5">          </span><span class="hl-4">if</span><span class="hl-5">(</span><span class="hl-3">err</span><span class="hl-5">) {</span><br/><span class="hl-5">            </span><span class="hl-3">res</span><span class="hl-5">.</span><span class="hl-7">send</span><span class="hl-5">(</span><span class="hl-3">err</span><span class="hl-5">);</span><br/><span class="hl-5">            </span><span class="hl-4">return</span><span class="hl-5">;</span><br/><span class="hl-5">          } </span><span class="hl-4">else</span><span class="hl-5"> {</span><br/><span class="hl-5">            </span><span class="hl-3">res</span><span class="hl-5">.</span><span class="hl-7">send</span><span class="hl-5">(</span><span class="hl-3">data</span><span class="hl-5">);</span><br/><span class="hl-5">            </span><span class="hl-4">return</span><span class="hl-5">;</span><br/><span class="hl-5">          }</span><br/><span class="hl-5">        });</span><br/><span class="hl-5">      } </span><span class="hl-4">else</span><span class="hl-5"> {</span><br/><span class="hl-5">        </span><span class="hl-1">const</span><span class="hl-5"> </span><span class="hl-8">funko</span><span class="hl-5">: </span><span class="hl-2">Funko</span><span class="hl-5"> = {</span><br/><span class="hl-5">          </span><span class="hl-3">_owner :</span><span class="hl-5"> </span><span class="hl-3">user</span><span class="hl-5">,</span><br/><span class="hl-5">          </span><span class="hl-3">_id:</span><span class="hl-5"> </span><span class="hl-3">id</span><span class="hl-5">,</span><br/><span class="hl-5">        };</span><br/><span class="hl-5">        </span><span class="hl-7">getReadRequest</span><span class="hl-5">(</span><span class="hl-3">funko</span><span class="hl-5">, (</span><span class="hl-3">err</span><span class="hl-5">,</span><span class="hl-3">data</span><span class="hl-5">) </span><span class="hl-1">=&gt;</span><span class="hl-5"> {</span><br/><span class="hl-5">          </span><span class="hl-4">if</span><span class="hl-5">(</span><span class="hl-3">err</span><span class="hl-5">) {</span><br/><span class="hl-5">            </span><span class="hl-3">res</span><span class="hl-5">.</span><span class="hl-7">send</span><span class="hl-5">(</span><span class="hl-3">err</span><span class="hl-5">);</span><br/><span class="hl-5">            </span><span class="hl-4">return</span><span class="hl-5">;</span><br/><span class="hl-5">          } </span><span class="hl-4">else</span><span class="hl-5"> {</span><br/><span class="hl-5">            </span><span class="hl-3">res</span><span class="hl-5">.</span><span class="hl-7">send</span><span class="hl-5">(</span><span class="hl-3">data</span><span class="hl-5">);</span><br/><span class="hl-5">            </span><span class="hl-4">return</span><span class="hl-5">;</span><br/><span class="hl-5">          }</span><br/><span class="hl-5">        });</span><br/><span class="hl-5">      }</span><br/><span class="hl-5">    }</span><br/><span class="hl-5">  } </span><span class="hl-4">else</span><span class="hl-5"> {</span><br/><span class="hl-5">    </span><span class="hl-1">const</span><span class="hl-5"> </span><span class="hl-8">response</span><span class="hl-5">: </span><span class="hl-2">ResponseType</span><span class="hl-5"> = {</span><br/><span class="hl-5">      </span><span class="hl-3">type:</span><span class="hl-5"> </span><span class="hl-6">&#39;error&#39;</span><span class="hl-5">,</span><br/><span class="hl-5">      </span><span class="hl-3">success:</span><span class="hl-5"> </span><span class="hl-1">false</span><span class="hl-5">,</span><br/><span class="hl-5">      </span><span class="hl-3">message:</span><span class="hl-5"> </span><span class="hl-6">&#39;Comando no válido&#39;</span><span class="hl-5">,</span><br/><span class="hl-5">    };</span><br/><span class="hl-5">    </span><span class="hl-3">res</span><span class="hl-5">.</span><span class="hl-7">send</span><span class="hl-5">(</span><span class="hl-3">response</span><span class="hl-5">);</span><br/><span class="hl-5">  }</span><br/><span class="hl-5">});</span><br/><br/><span class="hl-0">//? CONTROLAMOS LA ENTRADA DE UNA RUTA NO VALIDA</span><br/><span class="hl-3">app</span><span class="hl-5">.</span><span class="hl-7">get</span><span class="hl-5">(</span><span class="hl-6">&#39;/*&#39;</span><span class="hl-5">, (</span><span class="hl-3">_</span><span class="hl-5">, </span><span class="hl-3">res</span><span class="hl-5">) </span><span class="hl-1">=&gt;</span><span class="hl-5"> {</span><br/><span class="hl-5">  </span><span class="hl-3">res</span><span class="hl-5">.</span><span class="hl-7">status</span><span class="hl-5">(</span><span class="hl-10">404</span><span class="hl-5">).</span><span class="hl-7">send</span><span class="hl-5">(</span><span class="hl-6">&#39;&lt;h1&gt;404 Not Found&lt;/h1&gt;&#39;</span><span class="hl-5">);</span><br/><span class="hl-5">});</span><br/><br/><span class="hl-0">//? PUERTO DE ESCUCHA</span><br/><span class="hl-3">app</span><span class="hl-5">.</span><span class="hl-7">listen</span><span class="hl-5">(</span><span class="hl-10">3000</span><span class="hl-5">, () </span><span class="hl-1">=&gt;</span><span class="hl-5"> {</span><br/><span class="hl-5">  </span><span class="hl-3">console</span><span class="hl-5">.</span><span class="hl-7">log</span><span class="hl-5">(</span><span class="hl-6">&#39;Server running on port 3000&#39;</span><span class="hl-5">);</span><br/><span class="hl-5">});</span>
</code></pre>
<p>Tal y como puede observarse se instancia un servidor express que escucha en el puerto 3000. Se ha creado una ruta para la gestión de los comandos que se le pasan por query.</p>
<p>Se recogen todos los parámetros que se le pasan por query y se comprueba que el comando sea válido. En caso de que no lo sea se devuelve un error.</p>
<p>Principalmente se comprueba que el cmd  y el usuario no sean nulos o undefined. El resto de parámetros se comprueban más adelante.</p>
<p>Posteriormente se lleva a cabo toda la gestión de ficheros usando el patrón callback para la gestión de errores y de datos.</p>
<p>Mencionar que las respuestas del servidor son en formato JSON y que se ha definido una ruta por defecto para que en caso de no pasar ningun ruta para la gestión de ficheros (en nuestro caso &#39;/funkos&#39;) se emita un error 404.</p>

<a href="#ejercicio-pe102" id="ejercicio-pe102" style="color: inherit; text-decoration: none;">
  <h2>Ejercicio PE102</h2>
</a>
<p>Se nos ha solicitado desarrollar un servidor express para ejecutar comandos haciendo uso de childprocess como spawn para su ejecución.</p>
<p>El código llevado a cabo ha sido el siguiente:</p>
<pre><code class="language-ts"><span class="hl-1">const</span><span class="hl-5"> </span><span class="hl-8">app</span><span class="hl-5"> = </span><span class="hl-7">express</span><span class="hl-5">();</span><br/><br/><span class="hl-3">app</span><span class="hl-5">.</span><span class="hl-7">get</span><span class="hl-5">(</span><span class="hl-6">&#39;/execmd&#39;</span><span class="hl-5">, (</span><span class="hl-3">req</span><span class="hl-5">, </span><span class="hl-3">res</span><span class="hl-5">) </span><span class="hl-1">=&gt;</span><span class="hl-5"> {</span><br/><span class="hl-5">  </span><span class="hl-1">const</span><span class="hl-5"> </span><span class="hl-8">cmd</span><span class="hl-5"> = </span><span class="hl-3">req</span><span class="hl-5">.</span><span class="hl-3">query</span><span class="hl-5">.</span><span class="hl-3">cmd</span><span class="hl-5"> </span><span class="hl-4">as</span><span class="hl-5"> </span><span class="hl-2">string</span><span class="hl-5">;</span><br/><span class="hl-5">  </span><span class="hl-1">const</span><span class="hl-5"> </span><span class="hl-8">args</span><span class="hl-5">:</span><span class="hl-2">string</span><span class="hl-5"> = </span><span class="hl-3">req</span><span class="hl-5">.</span><span class="hl-3">query</span><span class="hl-5">.</span><span class="hl-3">args</span><span class="hl-5"> </span><span class="hl-4">as</span><span class="hl-5"> </span><span class="hl-2">string</span><span class="hl-5">;</span><br/><br/><span class="hl-5">  </span><span class="hl-0">//console.log(&#39;cmd: &#39;, cmd);</span><br/><span class="hl-5">  </span><span class="hl-0">//console.log(&#39;args: &#39;, args);</span><br/><br/><span class="hl-5">  </span><span class="hl-0">//? GESTIONAMOS QUE ESTAS VARIABLES SEAN UNDEFINED O NULAS</span><br/><span class="hl-5">  </span><span class="hl-4">if</span><span class="hl-5"> (!</span><span class="hl-3">cmd</span><span class="hl-5"> </span><span class="hl-0">/*|| !args*/</span><span class="hl-5">) {</span><br/><span class="hl-5">    </span><span class="hl-3">res</span><span class="hl-5">.</span><span class="hl-7">send</span><span class="hl-5">({</span><br/><span class="hl-5">      </span><span class="hl-3">error:</span><br/><span class="hl-5">        {</span><br/><span class="hl-5">          </span><span class="hl-3">Title:</span><span class="hl-5"> </span><span class="hl-6">&#39;Error&#39;</span><span class="hl-5">,</span><br/><span class="hl-5">          </span><span class="hl-3">Message:</span><span class="hl-5"> </span><span class="hl-6">&#39;No se ha especificado el comando&#39;</span><br/><span class="hl-5">        }</span><br/><span class="hl-5">    })</span><br/><span class="hl-5">    </span><span class="hl-4">return</span><span class="hl-5">;</span><br/><span class="hl-5">  }</span><br/><br/><span class="hl-5">  </span><span class="hl-1">let</span><span class="hl-5"> </span><span class="hl-3">child</span><span class="hl-5">;</span><br/><br/><span class="hl-5">  </span><span class="hl-4">if</span><span class="hl-5"> (!</span><span class="hl-3">args</span><span class="hl-5">) {</span><br/><span class="hl-5">    </span><span class="hl-3">child</span><span class="hl-5"> = </span><span class="hl-7">spawn</span><span class="hl-5">(</span><span class="hl-3">cmd</span><span class="hl-5">);</span><br/><span class="hl-5">  } </span><span class="hl-4">else</span><span class="hl-5"> {</span><br/><span class="hl-5">    </span><span class="hl-3">child</span><span class="hl-5"> = </span><span class="hl-7">spawn</span><span class="hl-5">(</span><span class="hl-3">cmd</span><span class="hl-5">, </span><span class="hl-3">args</span><span class="hl-5">.</span><span class="hl-7">split</span><span class="hl-5">(</span><span class="hl-6">&#39; &#39;</span><span class="hl-5">));</span><br/><span class="hl-5">  }</span><br/><span class="hl-5">  </span><span class="hl-0">//const child = spawn(cmd, args.split(&#39; &#39;));</span><br/><br/><span class="hl-5">  </span><span class="hl-1">let</span><span class="hl-5"> </span><span class="hl-3">dataToSend</span><span class="hl-5"> = </span><span class="hl-6">&#39;&#39;</span><span class="hl-5">;</span><br/><span class="hl-5">  </span><span class="hl-1">let</span><span class="hl-5"> </span><span class="hl-3">errorToSend</span><span class="hl-5"> = </span><span class="hl-6">&#39;&#39;</span><span class="hl-5">;</span><br/><br/><span class="hl-5">  </span><span class="hl-3">child</span><span class="hl-5">.</span><span class="hl-3">stdout</span><span class="hl-5">.</span><span class="hl-7">on</span><span class="hl-5">(</span><span class="hl-6">&#39;data&#39;</span><span class="hl-5">, (</span><span class="hl-3">data</span><span class="hl-5">) </span><span class="hl-1">=&gt;</span><span class="hl-5"> {</span><br/><span class="hl-5">    </span><span class="hl-3">dataToSend</span><span class="hl-5"> += </span><span class="hl-3">data</span><span class="hl-5">.</span><span class="hl-7">toString</span><span class="hl-5">();</span><br/><span class="hl-5">  });</span><br/><br/><span class="hl-5">  </span><span class="hl-3">child</span><span class="hl-5">.</span><span class="hl-3">stderr</span><span class="hl-5">.</span><span class="hl-7">on</span><span class="hl-5">(</span><span class="hl-6">&#39;data&#39;</span><span class="hl-5">, (</span><span class="hl-3">data</span><span class="hl-5">) </span><span class="hl-1">=&gt;</span><span class="hl-5"> {</span><br/><span class="hl-5">    </span><span class="hl-3">errorToSend</span><span class="hl-5"> += </span><span class="hl-3">data</span><span class="hl-5">.</span><span class="hl-7">toString</span><span class="hl-5">();</span><br/><span class="hl-5">  });</span><br/><br/><span class="hl-5">  </span><span class="hl-3">child</span><span class="hl-5">.</span><span class="hl-7">on</span><span class="hl-5">(</span><span class="hl-6">&#39;error&#39;</span><span class="hl-5">, (</span><span class="hl-3">err</span><span class="hl-5">) </span><span class="hl-1">=&gt;</span><span class="hl-5"> {</span><br/><span class="hl-5">    </span><span class="hl-3">errorToSend</span><span class="hl-5"> += </span><span class="hl-3">err</span><span class="hl-5">;</span><br/><span class="hl-5">  });</span><br/><br/><span class="hl-5">  </span><span class="hl-3">child</span><span class="hl-5">.</span><span class="hl-7">on</span><span class="hl-5">(</span><span class="hl-6">&#39;close&#39;</span><span class="hl-5">, (</span><span class="hl-3">code</span><span class="hl-5">) </span><span class="hl-1">=&gt;</span><span class="hl-5"> {</span><br/><span class="hl-5">    </span><span class="hl-4">if</span><span class="hl-5"> (</span><span class="hl-3">dataToSend</span><span class="hl-5">.</span><span class="hl-3">length</span><span class="hl-5"> &gt; </span><span class="hl-10">0</span><span class="hl-5">) {</span><br/><span class="hl-5">      </span><span class="hl-3">res</span><span class="hl-5">.</span><span class="hl-7">send</span><span class="hl-5">({</span><br/><span class="hl-5">        </span><span class="hl-3">data:</span><span class="hl-5"> {</span><br/><span class="hl-5">          </span><span class="hl-3">title:</span><span class="hl-5"> </span><span class="hl-6">&#39;Ejecución satisfactoria&#39;</span><span class="hl-5">,</span><br/><span class="hl-5">          </span><span class="hl-3">succes:</span><span class="hl-5"> </span><span class="hl-1">true</span><span class="hl-5">,</span><br/><span class="hl-5">          </span><span class="hl-3">output:</span><span class="hl-5"> </span><span class="hl-3">dataToSend</span><br/><span class="hl-5">        }</span><br/><span class="hl-5">      });</span><br/><span class="hl-5">      </span><span class="hl-4">return</span><span class="hl-5">;</span><br/><span class="hl-5">    } </span><span class="hl-4">else</span><span class="hl-5"> </span><span class="hl-4">if</span><span class="hl-5"> (</span><span class="hl-3">errorToSend</span><span class="hl-5">.</span><span class="hl-3">length</span><span class="hl-5"> &gt; </span><span class="hl-10">0</span><span class="hl-5">) {</span><br/><span class="hl-5">      </span><span class="hl-3">res</span><span class="hl-5">.</span><span class="hl-7">send</span><span class="hl-5">({</span><br/><span class="hl-5">        </span><span class="hl-3">error:</span><span class="hl-5"> {</span><br/><span class="hl-5">          </span><span class="hl-3">title:</span><span class="hl-5"> </span><span class="hl-6">&#39;Error&#39;</span><span class="hl-5">,</span><br/><span class="hl-5">          </span><span class="hl-3">succes:</span><span class="hl-5"> </span><span class="hl-1">false</span><span class="hl-5">,</span><br/><span class="hl-5">          </span><span class="hl-3">message:</span><span class="hl-5"> </span><span class="hl-3">errorToSend</span><br/><span class="hl-5">        }</span><br/><span class="hl-5">      });</span><br/><span class="hl-5">      </span><span class="hl-4">return</span><span class="hl-5">;</span><br/><span class="hl-5">    }</span><br/><span class="hl-5">  });</span><br/><span class="hl-5">});</span><br/><br/><span class="hl-0">//? CONTROLAMOS LA ENTRADA DE UNA RUTA NO VALIDA</span><br/><span class="hl-3">app</span><span class="hl-5">.</span><span class="hl-7">get</span><span class="hl-5">(</span><span class="hl-6">&#39;/*&#39;</span><span class="hl-5">, (</span><span class="hl-3">_</span><span class="hl-5">, </span><span class="hl-3">res</span><span class="hl-5">) </span><span class="hl-1">=&gt;</span><span class="hl-5"> {</span><br/><span class="hl-5">  </span><span class="hl-3">res</span><span class="hl-5">.</span><span class="hl-7">status</span><span class="hl-5">(</span><span class="hl-10">404</span><span class="hl-5">).</span><span class="hl-7">send</span><span class="hl-5">(</span><span class="hl-6">&#39;&lt;h1&gt;404 Not Found&lt;/h1&gt;&#39;</span><span class="hl-5">);</span><br/><span class="hl-5">});</span><br/><br/><span class="hl-0">//? PUERTO DE ESCUCHA</span><br/><span class="hl-3">app</span><span class="hl-5">.</span><span class="hl-7">listen</span><span class="hl-5">(</span><span class="hl-10">3000</span><span class="hl-5">, () </span><span class="hl-1">=&gt;</span><span class="hl-5"> {</span><br/><span class="hl-5">  </span><span class="hl-3">console</span><span class="hl-5">.</span><span class="hl-7">log</span><span class="hl-5">(</span><span class="hl-6">&#39;Server running on port 3000&#39;</span><span class="hl-5">);</span><br/><span class="hl-5">});</span>
</code></pre>
<p>Tal y como puede observarse se ha instanciado un servidor express y mediante la petición get se ha solicitado la ejecución de un comando. Para ello se ha hecho uso de la librería childprocess y su método spawn.</p>
<p>Pero primero se comprueba que el comando no sea nulo o undefined, en caso de serlo se devuelve un error mediante un fichero json. En caso de no serlo se procede a ejecutar el comando.</p>
<p>Primero se declara una string vacía que almacenará la salida del comando y otra que almacenará los errores que se puedan producir durante la ejecución del mismo.</p>
<p>Mediante eventos on &#39;data&#39; se va almacenando la salida del comando y los errores que se puedan producir. Despuesse comprueba cuales de las dos variables no es vacía y se ejecuta la función send de express para devolver un json con la salida del comando o los errores que se hayan producido.</p>

<a href="#__dificultadesreflexión" id="__dificultadesreflexión" style="color: inherit; text-decoration: none;">
  <h2>__Dificultades/Reflexión</h2>
</a>
<p>Al igual que en la anterior práctica, lo peor que he llevado en esta es el tiempo, no puedo realizar las cosas de la manera en la que me gusta debido a que no tengo tiempo suficiente para dedicarle y he tenido que salir del paso como en la pr 10 haciendo uso de api sincrona de node.js.</p>
<p>Esta semana he tenido que dedicarle un par de horas extras al trabajo para no tener que trabajar en la primera semana de mayo y así poder terminar todas las entregas finales que hay que desarrollar esa semana. Muy a mi pesar he tenido que dejar de lado el realizar estas prácticas como me gustaría.</p>

<a href="#referencias" id="referencias" style="color: inherit; text-decoration: none;">
  <h2>Referencias</h2>
</a>
<p><a href="https://ull-esit-inf-dsi-2223.github.io/prct11-http-express-funko-app/">Guión pr11</a></p>
<p><a href="https://ull-esit-inf-dsi-2223.github.io/nodejs-theory/">Apuntes bloque 2 de la asignatura</a></p>
<p><a href="https://coveralls.io/">Coveralls</a></p>
<p><a href="https://sonarcloud.io/explore/projects">SonarCloud</a></p>
<p><a href="https://nodejs.org/docs/latest-v19.x/api/fs.html">Documentación NODE.js</a></p>
</div></div>
<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
<div class="tsd-navigation settings">
<details class="tsd-index-accordion"><summary class="tsd-accordion-summary">
<h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M4.93896 8.531L12 15.591L19.061 8.531L16.939 6.409L12 11.349L7.06098 6.409L4.93896 8.531Z" fill="var(--color-text)"></path></svg> Settings</h3></summary>
<div class="tsd-accordion-details">
<div class="tsd-filter-visibility">
<h4 class="uppercase">Member Visibility</h4><form>
<ul id="tsd-filter-options">
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li>
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-private" name="private"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Private</span></label></li>
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li>
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></form></div>
<div class="tsd-theme-toggle">
<h4 class="uppercase">Theme</h4><select id="theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div>
<nav class="tsd-navigation primary">
<details class="tsd-index-accordion" open><summary class="tsd-accordion-summary">
<h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M4.93896 8.531L12 15.591L19.061 8.531L16.939 6.409L12 11.349L7.06098 6.409L4.93896 8.531Z" fill="var(--color-text)"></path></svg> Modules</h3></summary>
<div class="tsd-accordion-details">
<ul>
<li class="current selected"><a href="modules.html">pr10</a>
<ul>
<li class="tsd-kind-module"><a href="modules/EjercicioPE102_server.html">EjercicioPE102/server</a></li>
<li class="tsd-kind-module"><a href="modules/Funko_funkoInterface.html">Funko/funko<wbr/>Interface</a></li>
<li class="tsd-kind-module"><a href="modules/Funko_request.html">Funko/request</a></li>
<li class="tsd-kind-module"><a href="modules/Funko_server.html">Funko/server</a></li>
<li class="tsd-kind-module"><a href="modules/Funko_types.html">Funko/types</a></li>
<li class="tsd-kind-module"><a href="modules/Funko_utilities.html">Funko/utilities</a></li>
<li class="tsd-kind-module"><a href="modules/Funko_utilities2.html">Funko/utilities2</a></li></ul></li></ul></div></details></nav></div></div>
<div class="container tsd-generator">
<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div>
<div class="overlay"></div><script src="assets/main.js"></script></body></html>